<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0"
  >
  <title>Markdown Editor with SQL & Web Components</title>
  <link
    rel="stylesheet"
    href="style.css"
  >
</head>

<body>
  <div class="container">
    <div class="panel">
      <div class="panel-header">Markdown Editor</div>
      <div class="editor-container">
        <textarea id="editor"># Markdown + SQL + Web Components

Write your markdown here and see it rendered in real-time!
```sql name='summary'
SELECT
SUM(sales) as total_sales,
AVG(sales) as avg_sales,
COUNT(*) as num_products
FROM (
SELECT 'Product A' as product, 100 as sales
UNION ALL SELECT 'Product B', 150
UNION ALL SELECT 'Product C', 120
) t
```

<data-card data-ref='summary'></data-card>
```sql name='productList'
SELECT DISTINCT product
FROM (
  SELECT 'Product A' as product, 100 as sales, 'Q1' as quarter
  UNION ALL SELECT 'Product B', 150, 'Q1'
  UNION ALL SELECT 'Product C', 120, 'Q1'
  UNION ALL SELECT 'Product A', 130, 'Q2'
  UNION ALL SELECT 'Product B', 180, 'Q2'
  UNION ALL SELECT 'Product C', 140, 'Q2'
) t
ORDER BY product
```

<dropdown-component data-ref='productList' name='productSelection'></dropdown-component>
```sql name='salesData'
WITH source_data AS (
  SELECT 'Product A' as product, 100 as sales, 'Q1' as quarter
  UNION ALL SELECT 'Product B', 150, 'Q1'
  UNION ALL SELECT 'Product C', 120, 'Q1'
  UNION ALL SELECT 'Product A', 130, 'Q2'
  UNION ALL SELECT 'Product B', 180, 'Q2'
  UNION ALL SELECT 'Product C', 140, 'Q2'
)
SELECT * FROM source_data
WHERE {{input.productSelection}} = []
  OR product IN (SELECT unnest({{input.productSelection}}))
```

<vegalite-chart
  spec='{"$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "description": "Sales by Product and Quarter",
  "mark": "bar",
  "encoding": {
    "x": {"field": "product", "type": "nominal", "title": "Product"},
    "y": {"field": "sales", "type": "quantitative", "title": "Sales"},
    "color": {"field": "quarter", "type": "nominal", "title": "Quarter"}
  }}'
  data-ref='salesData'>
</vegalite-chart>

<data-table-component data-ref='salesData'></data-table-component>

</textarea>
      </div>
    </div>

    <div class="panel">
      <div class="panel-header">Preview</div>
      <div class="preview-container">
        <div
          class="preview-content"
          id="preview"
        ></div>
      </div>
    </div>
  </div>

  <script
    type="module"
    src="./index.js"
  ></script>
</body>

</html>